generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Models
model Establishment {
  id            String   @id @default(uuid())
  name          String
  phone         String   @unique
  description   String?
  email         String   @unique
  address       String
  image         String
  password_hash String
  salt          String?
  latitude      Float?
  longitude     Float?
  opening_hours Json
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  collaborators Collaborator[]
  services      Services[]
  appointments  Appointment[]
  users         Users[]

  @@index([name])
  @@map("establishments")
}

model Collaborator {
  id            String         @id @default(uuid())
  name          String
  phone         String
  email         String         @unique
  specialities  Specialities
  avatar        String?
  working_days  WorkingDays[]
  working_hours WorkingHours[]
  role          Role           @default(COLLABORATOR)
  created_at    DateTime       @default(now())
  updated_at    DateTime       @updatedAt

  establishment    Establishment? @relation(fields: [establishment_id], references: [id])
  establishment_id String?
  appointments     Appointment[]
  servicesId       String?

  @@map("collaborators")
}

model Users {
  id               String         @id @default(uuid())
  name             String?
  phone            String?
  email            String         @unique
  password         String
  role             Role           @default(ADMIN)
  created_at       DateTime       @default(now())
  updated_at       DateTime       @updatedAt
  appointments     Appointment[]
  establishment    Establishment? @relation(fields: [establishment_id], references: [id])
  establishment_id String?

  @@map("users")
}

model Appointment {
  id               String   @id @default(uuid())
  user_id          String
  collaborator_id  String
  establishment_id String
  service_id       String
  status           Status   @default(PENDING)
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt
  appointment_date DateTime @default(now())

  user          Users         @relation(fields: [user_id], references: [id])
  collaborator  Collaborator  @relation(fields: [collaborator_id], references: [id])
  establishment Establishment @relation(fields: [establishment_id], references: [id])

  @@index([created_at, updated_at])
  @@map("appointments")
}

model Services {
  id                String            @id @default(uuid())
  description       String?
  price             Decimal           @db.Decimal(10, 2)
  duration          Int // duration in minutes
  establishmentType EstablishmentType
  active            Boolean           @default(true)
  created_at        DateTime          @default(now())
  updated_at        DateTime          @updatedAt
  establishment     Establishment?    @relation(fields: [establishment_id], references: [id])
  establishment_id  String?

  @@index([establishmentType])
  @@map("services")
}

model WorkingHours {
  id              String       @id @default(uuid())
  start_time      String
  end_time        String
  collaborator    Collaborator @relation(fields: [collaborator_id], references: [id])
  collaborator_id String
  created_at      DateTime     @default(now())
  updated_at      DateTime     @updatedAt

  @@map("working_hours")
}

model WorkingDays {
  id              String          @id @default(uuid())
  day             WorkingDaysEnum
  collaborator    Collaborator    @relation(fields: [collaborator_id], references: [id])
  collaborator_id String
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt

  @@map("working_days")
}

// Enums
enum EstablishmentType {
  BARBERSHOP
  BEAUTY_SALON
}

enum Status {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELED
}

enum Role {
  ADMIN
  COLLABORATOR
  USER
}

enum WorkingDaysEnum {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum Specialities {
  HAIR_CUT
  HAIR_COLOR
  HAIR_STYLING
  HAIR_TREATMENT
  HAIR_EXTENSIONS
  HAIR_REMOVAL
  MANICURE
  PEDICURE
  EYEBROW_DESIGN
  EYEBROW_TINTING
  EYEBROW_WASHING
  EYEBROW_TRIMMING
  EYEBROW_SHAPING
}
