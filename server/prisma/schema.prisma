generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums
enum EstablishmentType {
  BARBERSHOP
  BEAUTY_SALON
}

model Establishment {
  id            String   @id @default(uuid())
  name          String
  phone         String   @unique
  description   String?
  email         String   @unique
  address       String
  image         String
  password_hash String
  salt          String?
  latitude      Float?
  longitude     Float?
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  SpecialDate  SpecialDate[]
  WorkingDay   WorkingDay[]
  Collaborator Collaborator[]
  User         User[]
  Appointment  Appointment[]
  Service      Service[]

  @@index([name])
  @@map("establishments")
}

model Collaborator {
  id           String       @id @default(uuid())
  name         String
  phone        String
  email        String       @unique
  avatar       String?
  working_days WorkingDay[]
  role         Role         @default(COLLABORATOR)
  created_at   DateTime     @default(now())
  updated_at   DateTime     @updatedAt

  establishment    Establishment? @relation(fields: [establishment_id], references: [id])
  establishment_id String?
  appointments     Appointment[]

  @@map("collaborators")
}

model Speciality {
  id          String   @id @default(uuid())
  name        String
  description String?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  @@map("specialities")
}

model User {
  id               String         @id @default(uuid())
  name             String?
  phone            String?
  email            String         @unique
  password         String
  confirm_password String         @default("")
  role             Role           @default(ADMIN)
  created_at       DateTime       @default(now())
  updated_at       DateTime       @updatedAt
  appointments     Appointment[]
  establishment    Establishment? @relation(fields: [establishment_id], references: [id])
  establishment_id String?

  @@map("users")
}

model Appointment {
  id               String        @id @default(uuid())
  user_id          String
  collaborator_id  String
  establishment_id String
  service_id       String
  status           Status        @default(PENDING)
  created_at       DateTime      @default(now())
  updated_at       DateTime      @updatedAt
  appointment_date DateTime      @default(now())
  day_of_week      String
  open_time        String
  close_time       String
  user             User          @relation(fields: [user_id], references: [id])
  collaborator     Collaborator  @relation(fields: [collaborator_id], references: [id])
  establishment    Establishment @relation(fields: [establishment_id], references: [id])

  @@index([created_at, updated_at])
  @@map("appointments")
}

model Service {
  id                 String            @id @default(uuid())
  description        String?
  price              Decimal           @db.Decimal(10, 2)
  duration           Int // duration in minutes
  establishment_type EstablishmentType
  active             Boolean           @default(true)
  created_at         DateTime          @default(now())
  updated_at         DateTime          @updatedAt
  establishment      Establishment?    @relation(fields: [establishment_id], references: [id])
  establishment_id   String?

  @@index([establishment_type])
  @@map("services")
}

model WorkingDay {
  id String @id @default(uuid())

  day_of_week WorkingDaysEnum
  open_time   String
  close_time  String

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  establishment    Establishment @relation(fields: [establishment_id], references: [id])
  establishment_id String
  Collaborator     Collaborator? @relation(fields: [collaborator_id], references: [id])
  collaborator_id  String?

  @@map("working_days")
}

model SpecialDate {
  id         String   @id @default(uuid())
  date       DateTime
  is_closed  Boolean
  open_time  String?
  close_time String?

  establishment    Establishment @relation(fields: [establishment_id], references: [id])
  establishment_id String
}

enum Status {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELED
}

enum Role {
  ADMIN
  COLLABORATOR
  USER
}

enum WorkingDaysEnum {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}
